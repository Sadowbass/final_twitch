<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="stream">
	<select id="select" resultType="bean.StreamerVo">
		select mem_id,mem_name,mem_email,mem_status,(select count(mfo_serial) from final_mfollow where mfo_oid=mem_id)cnt,
	    (select sum(don_price)*0.5 from final_donation where don_oid=mem_id)+(select count(sub_serial) from final_subscription where sub_oid=mem_id)*5000 profit 
		from final_member where MEM_SKEY is not null
	</select>
	 <select id='view' parameterType="String" resultType="bean.StreamerVo">
    	select mem_id,mem_name,mem_email,mem_status,(select count(mfo_serial) from final_mfollow where mfo_oid=mem_id)cnt,
	    (select sum(don_price)*0.5 from final_donation where don_oid=mem_id)+(select count(sub_serial) from final_subscription where sub_oid=mem_id)*5000 profit,
	    (select sum(don_price) from final_donation where don_oid=mem_id) don_profit,
	    (select count(sub_serial) from final_subscription where sub_oid=mem_id)*5000 sub_profit,
	    (select count(sub_serial) from final_subscription where sub_oid=mem_id) cnt2,
	    (select ph_sysfile from final_photo where mem_id =ph_id) ph_sysfile
		from final_member where mem_id='${_parameter}'
    </select>
    
    <select id="weekly_broad_time" parameterType="hashmap" resultType="String">
		select bef_time from final_before where bef_mid=#{mid} and to_char(bef_rdate,'rrrr-mm-dd')=#{day}
	</select>
	
	 <select id="monthly_broad_time" parameterType="hashmap" resultType="String">
		select bef_time from final_before where bef_mid=#{mid} and to_char(bef_rdate,'mm')=#{month} and to_char(bef_rdate,'rrrr')=#{year}
	</select>
	
	<select id="year_broad_time" parameterType="hashmap" resultType="String">
		select bef_time from final_before where bef_mid=#{mid} and to_char(bef_rdate,'rrrr')=#{year}
	</select>
	
	<select id="weekly_follow" parameterType="hashmap" resultType="String">
		select count(mfo_serial) from final_mfollow where mfo_oid=#{mid} and to_char(mfo_date,'rrrr-mm-dd') = #{day}
	</select>
	
	<select id="weekly_sub" parameterType="hashmap" resultType="String">
		select count(sub_serial) from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'rrrr-mm-dd') = #{day}
	</select>
	
	<select id="weekly_follow_tot" parameterType="hashmap" resultType="String">
		select count(mfo_serial) 
		from final_mfollow 
		where mfo_oid=#{mid} and mfo_date &lt; #{day}
	</select>
	
	<select id="weekly_sub_tot" parameterType="hashmap" resultType="String">
		select count(sub_serial) from final_subscription where sub_oid=#{mid} and sub_rdate &lt; #{day}
	</select>
	
	<select id="monthly_sub" parameterType="hashmap" resultType="String">
		select count(sub_serial) from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'mm') = #{month} and to_char(sub_rdate,'rrrr')= #{year}
	</select>
	
	<select id="monthly_follow" parameterType="hashmap" resultType="String">
		select count(mfo_serial) from final_mfollow where mfo_oid=#{mid} and to_char(mfo_date,'mm') = #{month} and to_char(mfo_date,'rrrr')= #{year}
	</select>
	
	<select id="monthly_sub_tot" parameterType="hashmap" resultType="String">
		select count(sub_serial) from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'mm') &lt; #{month} and to_char(sub_rdate,'rrrr')= #{year}
	</select>
	
	<select id="monthly_follow_tot" parameterType="hashmap" resultType="String">
		select count(mfo_serial) from final_mfollow where mfo_oid=#{mid} and to_char(mfo_date,'mm') &lt; #{month} and to_char(mfo_date,'rrrr')= #{year}
	</select>
	
	<select id="year_sub" parameterType="hashmap" resultType="String">
		select count(sub_serial) from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'rrrr') = #{year}
	</select>
	
	<select id="year_follow" parameterType="hashmap" resultType="String">
		select count(mfo_serial) from final_mfollow where mfo_oid=#{mid} and to_char(mfo_date,'rrrr') = #{year}
	</select>
	
	<select id="year_sub_tot" parameterType="hashmap" resultType="String">
		select count(sub_serial) from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'rrrr') &lt; #{year}
	</select>
	
	<select id="year_follow_tot" parameterType="hashmap" resultType="String">
		select count(mfo_serial) from final_mfollow where mfo_oid=#{mid} and to_char(mfo_date,'rrrr') &lt; #{year}
	</select>
	
	<select id="weekly_don" parameterType="hashmap" resultType="String">
		select sum(don_price)*0.5 from final_donation where don_oid=#{mid} and to_char(don_rdate,'rrrr-mm-dd') = #{day} and type!=3
	</select>
	
	<select id="weekly_subprofit" parameterType="hashmap" resultType="String">
		select count(sub_serial)*5000 from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'rrrr-mm-dd') = #{day} 
	</select>
	
	<select id="monthly_subprofit" parameterType="hashmap" resultType="String">
		select count(sub_serial)*5000 from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'mm') = #{month} and to_char(sub_rdate,'rrrr')= #{year}
	</select>
	
	<select id="monthly_don" parameterType="hashmap" resultType="String">
		select sum(don_price)*0.5 from final_donation where don_oid=#{mid} and to_char(don_rdate,'mm') = #{month} and to_char(don_rdate,'rrrr') =#{year} and type!=3
	</select>
	
	<select id="year_subprofit" parameterType="hashmap" resultType="String">
		select count(sub_serial)*5000 from final_subscription where sub_oid=#{mid} and to_char(sub_rdate,'rrrr')= #{year}
	</select>
	
	<select id="year_don" parameterType="hashmap" resultType="String">
		select sum(don_price)*0.5 from final_donation where don_oid=#{mid} and to_char(don_rdate,'rrrr') =#{year} and type!=3
	</select>
	
	 <insert id="broadban" parameterType='String'>
    	insert into final_broadban(bban_serial,bban_id,bban_rdate)
    	values(seq_bban.nextval,'${_parameter}',sysdate)
    </insert>
    
    <select id="isban" parameterType="String" resultType="Integer">
		select count(bban_serial) from final_broadban where bban_id='${_parameter}'
	</select>
	
	<delete id='broadok' parameterType="String">
    	delete from final_broadban where bban_id='${_parameter}'
    </delete>
    
    <select id='gcategory' parameterType="hashmap" resultType="bean.GCategoryVo">
    	select count(SERIAL)cnt ,gamename from FINAL_BROADCASTINGINFO 
    	where mid=#{mid} and rdate between #{s_day} and #{l_day} group by gamename
    </select>
    
    <select id='gcategory_m' parameterType="hashmap" resultType="bean.GCategoryVo">
    	select count(SERIAL)cnt ,gamename from FINAL_BROADCASTINGINFO 
    	where mid=#{mid} and to_char(rdate,'mm') =#{month} and to_char(rdate,'rrrr') =#{year} group by gamename
    </select>
    
    <select id='gcategory_y' parameterType="hashmap" resultType="bean.GCategoryVo">
    	select count(SERIAL)cnt ,gamename from FINAL_BROADCASTINGINFO 
    	where mid=#{mid} and to_char(rdate,'rrrr') =#{year} group by gamename
    </select>
    
    <select id='d_profit' parameterType="hashmap" resultType="bean.StreamerVo">
    	select don_oid,sum(don_price)*0.5 profit,(select mem_name from final_member where mem_id=don_oid) mem_name from final_donation
        where to_char(don_rdate,'rrrr')=${year} group by don_oid order by profit desc
    </select>
    
    <select id='d_profit2' parameterType="bean.Page" resultType="bean.StreamerVo">
    	select * from
		(select rownum rn,M.* from(
			select don_oid,sum(don_price)*0.5 profit,(select mem_name from final_member where mem_id=don_oid) mem_name 
			from final_donation
        	where to_char(don_rdate,'rrrr')=#{year} 
       		group by don_oid order by profit desc)M
		) where rn between #{startNo} and #{endNo}
    </select>
    
    <select id='s_profit' parameterType="bean.Page" resultType="bean.StreamerVo">
    select count(sub_serial)cnt,sub_oid from final_subscription where to_char(sub_rdate,'rrrr')=#{year} group by sub_oid
    </select>
    
    <select id='s_profit2' parameterType="bean.Page" resultType="bean.StreamerVo">
    select * from
		(select rownum rn,M.* from(
			 select count(sub_serial)*5000 profit,sub_oid,(select mem_name from final_member where mem_id=sub_oid)mem_name 
			 from final_subscription 
			 where to_char(sub_rdate,'rrrr')=#{year} 
			 group by sub_oid order by profit desc)M
		) where rn between #{startNo} and #{endNo}
    </select>
    
     <select id='done_profit' parameterType="hashmap" resultType="bean.StatisticVo">
    	select sum(don_price)*0.5 profit,to_char(don_rdate,'mm') month from final_donation 
    	where to_char(don_rdate,'rrrr')=#{year} and type!=3 group by to_char(don_rdate,'mm') order by month
    </select>
    
    <select id='sub_profit' parameterType="hashmap" resultType="bean.StatisticVo">
    	select count(sub_serial)*5000 profit,to_char(sub_rdate,'mm') month 
    	from FINAL_SUBSCRIPTION where to_char(sub_rdate,'rrrr') =#{year} 
		group by to_char(sub_rdate,'mm') order by month
    </select>
    
    <select id='payment' parameterType="hashmap" resultType="bean.StatisticVo">
    	select sum(pay_money)profit,to_char(pay_date,'mm') month from final_payment 
    	where to_char(pay_date,'rrrr') =#{year}
		group by to_char(pay_date,'mm') order by month
    </select>
    
    <select id='onair' resultType="bean.StreamingVo">
    	select air_mid,air_subject,air_gname,air_thumbnail 
    	from final_onair
    </select>
    
     <select id="mileage" parameterType="String" resultType="bean.StatisticVo">
		select serial,pay_mid,pay_money,pay_date
		from final_payment where pay_mid ='${parameter}' order by pay_date
	</select>
	
	<select id="mileage_use" parameterType="String"  resultType="bean.StatisticVo">
		select don_oid,don_price,don_rdate,type from final_donation 
		where don_mid='${_parameter}' order by don_rdate desc
	</select>
	
	<select id='watching_time' parameterType="hashmap" resultType="String">
    	select 
     	sum(round(EXTRACT(day FROM exit_time-enter_time)*24 
    	+EXTRACT(HOUR   FROM exit_time-enter_time) 
     	+EXTRACT(MINUTE FROM exit_time-enter_time)/60 
     	+EXTRACT(SECOND FROM exit_time-enter_time)/60/60,1)) time
 		FROM final_userlist where oid=#{mid} and to_char(exit_time,'mm')=#{month} 
 		and to_char(exit_time,'rrrr')=#{year} group by oid
    </select>
    
    <select id='watching_tot' parameterType="hashmap" resultType="String">
    	select 
     	sum(round(EXTRACT(day FROM exit_time-enter_time)*24 
    	+EXTRACT(HOUR   FROM exit_time-enter_time) 
     	+EXTRACT(MINUTE FROM exit_time-enter_time)/60 
     	+EXTRACT(SECOND FROM exit_time-enter_time)/60/60,1)) time
 		FROM final_userlist where oid=#{mid} group by oid
    </select>
    
    <select id='last_pay' parameterType="hashmap" resultType="String">
    	select  sum(amount)tot from store_order 
    	where mem_id=#{mid} and to_char(order_date,'rrrr')=#{year} 
    	group by to_char(order_date,'mm') order by to_char(order_date,'mm')
    </select>
    
    <select id='last_pay_tot' parameterType="hashmap" resultType="String">
    	  select sum(amount)tot from store_order where mem_id=#{mid}
    </select>
    
     <select id='store_cate' parameterType="hashmap" resultType="bean.UserProductVo">
    	  select product_cate,count(product_cate) cnt from order_details od,product p
		  where mem_id=#{mid} and od.product_id =p.product_id group by product_cate
    </select>
    
    <select id='store_buylist' parameterType="hashmap" resultType="bean.UserProductVo">
    	  select DISTINCT p.PRODUCT_ID, p.PRODUCT_PRICE, p.PRODUCT_NAME,min(SYSFILE) sysfile,to_char(order_date,'rrrr-mm-dd')order_date,od.cart_count
		  from PRODUCT_PHOTO ph,
     	  PRODUCT p,
     	  ORDER_DETAILS od,
     	  store_order s
		  where ph.PRODUCT_ID = p.PRODUCT_ID and od.PRODUCT_ID = p.PRODUCT_ID and od.MEM_ID =#{mid} and s.order_serial = od.order_serial
		  group by p.product_id, p.PRODUCT_PRICE, p.PRODUCT_NAME,order_date,od.cart_count
		  order by p.PRODUCT_ID
    </select>
    
    <select id='send_donation' parameterType="hashmap" resultType="bean.StreamerVo">	 
	select sum(don_price) profit,don_oid from final_donation 
	where don_mid=#{mid} group by don_oid order by profit desc
    </select>
    
    <select id='receive_donation' parameterType="hashmap" resultType="bean.StreamerVo">
    	 select sum(don_price) profit,don_mid from final_donation 
    	 where don_oid=#{mid} group by don_mid order by profit desc
    </select>
    
     <select id='user_payment' parameterType="hashmap" resultType="bean.StatisticVo">
    	select sum(pay_money)profit ,to_char(pay_date,'mm') month from final_payment 
    	where pay_mid =#{mid} and to_char(pay_date,'rrrr')=#{year} 
    	group by to_char(pay_date,'mm') order by month
    </select>
   

	<!--<select id="select" resultType="bean.BroadCastingCateVo">
		select * from final_category
	</select>
	
	 <select id='view' parameterType="String" resultType="bean.BroadCastingCateVo">
    	select * from final_category
    	where cat_serial='${_parameter}'
    </select>

     <delete id='delete' parameterType="bean.BroadCastingCateVo">
    	delete from final_category where cat_serial=#{cat_serial}
    </delete>
    
     <update id='update' parameterType="bean.BroadCastingCateVo">
    	update final_category set cat_gname=#{cat_gname}, cat_genre=#{cat_genre}
    	where cat_serial=#{cat_serial} 
    </update>
    
     <select id='ph_sysfile' parameterType="bean.BroadCastingCateVo" resultType="bean.BroadCastingCateVo">
    	select cat_sysfile from final_category
    	where cat_serial=#{cat_serial}
    </select>
    
    <update id='ph_modify' parameterType="bean.BroadCastingCateVo">
    	update final_category set cat_orifile=#{cat_orifile}, cat_sysfile=#{cat_sysfile}
    	where cat_serial=#{cat_serial} 
    </update>
    
    <insert id="insert" parameterType='bean.BroadCastingCateVo'>
    	insert into final_category(cat_serial,cat_gname,cat_genre,cat_orifile,cat_sysfile) 
    	values(seq_cate.nextval,#{cat_gname},#{cat_genre},#{cat_orifile},#{cat_sysfile})
    </insert>
    
    <select id="tag_select" resultType="bean.TagVo">
		select * from final_tag
	</select>
	
	 <select id="tag_search" parameterType="String" resultType="bean.TagVo">
		select * from final_tag where tag_name like '%${_parameter}%'
	</select>
	
	<delete id='tag_delete' parameterType="String">
    	delete from final_tag where tag_serial='${_parameter}'
    </delete>
    
     <insert id="tag_insert" parameterType='String'>
    	insert into final_tag(tag_serial,tag_name) 
    	values(seq_tag.nextval,'${_parameter}')
    </insert>-->

 
</mapper>